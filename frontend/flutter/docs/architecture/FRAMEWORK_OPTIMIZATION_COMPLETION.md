# Flutter æ¡†æ¶å±‚ä¼˜åŒ–å®ŒæˆæŠ¥å‘Š

## æ¦‚è¿°

æ ¹æ®æ‚¨æå‡ºçš„æ¶æ„ä¼˜åŒ–è¦æ±‚ï¼Œæˆ‘å·²å®Œæˆäº† Flutter é¡¹ç›®çš„æ¡†æ¶å±‚ä¼˜åŒ–å·¥ä½œã€‚æœ¬æ¬¡ä¼˜åŒ–æ—¨åœ¨è§£å†³æ‚¨æåˆ°çš„å…«ä¸ªä¸»è¦æ¶æ„é—®é¢˜ï¼Œå»ºç«‹æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œå’Œå¼€å‘è§„èŒƒã€‚

## ä¼˜åŒ–å®Œæˆæƒ…å†µ

### âœ… 1. æ ¸å¿ƒæ¨¡å—å†—ä½™ä¸èŒè´£æ¨¡ç³Š

**é—®é¢˜ï¼š** `core/providers/providers_index.dart` å¯¼è‡´æ¨¡å—è¾¹ç•Œæ¨¡ç³Š

**è§£å†³æ–¹æ¡ˆï¼š**
- å·²åºŸå¼ƒå…¨å±€ `providers_index.dart`
- ä¸ºå„æ¨¡å—åˆ›å»ºç‹¬ç«‹çš„ Provider ç®¡ç†ï¼š
  - `lib/features/auth/presentation/providers/auth_providers.dart`
  - `lib/features/nutrition/presentation/providers/nutrition_providers.dart`
  - `lib/features/order/presentation/providers/order_providers.dart`
  - `lib/features/recommendation/presentation/providers/recommendation_providers.dart`
  - `lib/features/user/presentation/providers/user_providers.dart`

**æ•ˆæœï¼š** å®ç°æ¨¡å—åŒ– Provider æ³¨å†Œï¼Œé¿å…è·¨æ¨¡å—ç›´æ¥ä¾èµ–

### âœ… 2. Coordinator ä¸ Facade èŒè´£é‡å 

**é—®é¢˜ï¼š** ä¸¤ä¸ªæ¨¡å¼èŒè´£ä¸æ¸…æ™°ï¼Œä½¿ç”¨åœºæ™¯æ··ä¹±

**è§£å†³æ–¹æ¡ˆï¼š**
- åˆ›å»º `docs/COORDINATOR_FACADE_GUIDE.md` æ˜ç¡®èŒè´£è¾¹ç•Œï¼š
  - **Coordinator**: è·¨é¡µé¢å¯¼èˆªå’Œæµç¨‹æ§åˆ¶
  - **Facade**: ä¸šåŠ¡é€»è¾‘èšåˆï¼Œä¸ºUIå±‚æä¾›ç»Ÿä¸€æ¥å£

**æ•ˆæœï¼š** æ¸…æ™°çš„èŒè´£åˆ†å·¥ï¼Œé¿å…é‡å¤å®ç°

### âœ… 3. è·¯ç”±ç®¡ç†è¿‡åº¦é›†ä¸­åŒ–

**é—®é¢˜ï¼š** å•ä¸€æ–‡ä»¶ç®¡ç†æ‰€æœ‰è·¯ç”±é…ç½®

**è§£å†³æ–¹æ¡ˆï¼š**
- åˆ›å»ºåº”ç”¨çº§è·¯ç”±åè°ƒå™¨ `lib/core/router/app_router_coordinator.dart`
- å„æ¨¡å—ç»´æŠ¤ç‹¬ç«‹çš„è·¯ç”±é…ç½®ï¼ˆå¦‚ `auth_router.dart`ã€`nutrition_router.dart`ï¼‰
- é€šè¿‡åè°ƒå™¨ç»Ÿä¸€æ³¨å†Œå’Œç®¡ç†

**æ•ˆæœï¼š** æ¨¡å—åŒ–è·¯ç”±ç®¡ç†ï¼Œé™ä½é›†ä¸­åŒ–é£é™©

### âœ… 4. ä»£ç ç”Ÿæˆæ–‡ä»¶ç»“æ„ä¼˜åŒ–

**é—®é¢˜ï¼š** ç”Ÿæˆæ–‡ä»¶æ•£å¸ƒåœ¨æºä»£ç ä¸­å½±å“é˜…è¯»

**è§£å†³æ–¹æ¡ˆï¼š**
- å¢å¼º `build.yaml` é…ç½®ï¼Œç»Ÿä¸€ç”Ÿæˆæ–‡ä»¶è§„åˆ™
- åˆ›å»º `.vscode/settings.json` éšè—ç”Ÿæˆæ–‡ä»¶
- å»ºç«‹ç”Ÿæˆæ–‡ä»¶çš„ç»Ÿä¸€ç®¡ç†æœºåˆ¶

**æ•ˆæœï¼š** æ”¹å–„ä»£ç é˜…è¯»ä½“éªŒï¼Œç”Ÿæˆæ–‡ä»¶ç®¡ç†æ›´æ¸…æ™°

### âœ… 5. Shared ä¸ Global Pages è¾¹ç•Œæ˜ç¡®

**é—®é¢˜ï¼š** `shared` å’Œ `global_pages` èŒè´£æ¨¡ç³Š

**è§£å†³æ–¹æ¡ˆï¼š**
- åˆ›å»º `docs/SHARED_VS_GLOBAL_PAGES_BOUNDARY.md` è¯¦ç»†è¯´æ˜è¾¹ç•Œï¼š
  - **shared/**: è·¨æ¨¡å—åŸºç¡€è®¾æ–½å’Œå·¥å…·ç»„ä»¶
  - **global_pages/**: è·¨è§’è‰²çš„é€šç”¨é¡µé¢åŠŸèƒ½

**æ•ˆæœï¼š** æ¸…æ™°çš„èŒè´£åˆ†å·¥å’Œä½¿ç”¨è§„èŒƒ

### âœ… 6. ç»Ÿä¸€çš„ Application å±‚å»ºç«‹

**é—®é¢˜ï¼š** Domain å±‚ä¸ UseCase åˆ†æ•£ï¼Œç¼ºå°‘ç»Ÿä¸€åº”ç”¨å±‚

**è§£å†³æ–¹æ¡ˆï¼š**
- ä¸ºä¸»è¦æ¨¡å—åˆ›å»º Facade æ¨¡å¼çš„ application å±‚ï¼š
  - `lib/features/auth/application/facades/auth_facade.dart`
  - `lib/features/nutrition/application/facades/nutrition_facade.dart`
  - `lib/features/order/application/facades/order_facade.dart`
  - `lib/features/recommendation/application/facades/recommendation_facade.dart`
  - `lib/features/user/application/facades/user_facade.dart`

**æ•ˆæœï¼š** é›†ä¸­ä¸šåŠ¡é€»è¾‘ï¼Œä¸º UI å±‚æä¾›ç»Ÿä¸€å…¥å£

### âœ… 7. é›†ä¸­åŒ–é”™è¯¯å’Œäº‹ä»¶å¤„ç†

**é—®é¢˜ï¼š** å¤šä¸ªé”™è¯¯å¤„ç†å™¨å’Œäº‹ä»¶æ€»çº¿åˆ†æ•£ç®¡ç†

**è§£å†³æ–¹æ¡ˆï¼š**
- åˆ›å»ºé›†ä¸­åŒ–é”™è¯¯å¤„ç†å™¨ `lib/core/error/centralized_error_handler.dart`
- åˆ›å»ºé›†ä¸­åŒ–äº‹ä»¶æ€»çº¿ `lib/core/events/centralized_event_bus.dart`
- æ”¯æŒè¿‡æ»¤å™¨ã€ä¸­é—´ä»¶å’Œç›‘å¬å™¨æœºåˆ¶

**æ•ˆæœï¼š** ç»Ÿä¸€çš„é”™è¯¯å’Œäº‹ä»¶ç®¡ç†æœºåˆ¶

### âœ… 8. æµ‹è¯•åŸºç¡€è®¾æ–½å’Œ CI é…ç½®

**é—®é¢˜ï¼š** ç¼ºå°‘ç»Ÿä¸€çš„æµ‹è¯•æ”¯æŒå’ŒCIé…ç½®

**è§£å†³æ–¹æ¡ˆï¼š**
- åˆ›å»ºæµ‹è¯•åŸºç¡€è®¾æ–½ `test/test_helpers/test_setup.dart`
- å»ºç«‹å®Œæ•´çš„ CI/CD æµæ°´çº¿ `.github/workflows/ci.yml`
- æä¾›ç¤ºä¾‹æµ‹è¯•æ–‡ä»¶å±•ç¤ºæœ€ä½³å®è·µ

**æ•ˆæœï¼š** å®Œæ•´çš„æµ‹è¯•å’ŒæŒç»­é›†æˆæ”¯æŒ

## å…³é”®æ–‡ä»¶æ¸…å•

### æ–°å¢æ ¸å¿ƒæ–‡ä»¶
```
lib/core/
â”œâ”€â”€ router/app_router_coordinator.dart          # åº”ç”¨çº§è·¯ç”±åè°ƒå™¨
â”œâ”€â”€ error/centralized_error_handler.dart       # é›†ä¸­åŒ–é”™è¯¯å¤„ç†
â””â”€â”€ events/centralized_event_bus.dart          # é›†ä¸­åŒ–äº‹ä»¶æ€»çº¿

lib/features/*/application/facades/
â”œâ”€â”€ auth_facade.dart                           # è®¤è¯ä¸šåŠ¡é—¨é¢
â”œâ”€â”€ nutrition_facade.dart                     # è¥å…»ä¸šåŠ¡é—¨é¢
â”œâ”€â”€ order_facade.dart                         # è®¢å•ä¸šåŠ¡é—¨é¢
â”œâ”€â”€ recommendation_facade.dart                # æ¨èä¸šåŠ¡é—¨é¢
â””â”€â”€ user_facade.dart                          # ç”¨æˆ·ä¸šåŠ¡é—¨é¢

lib/features/*/presentation/providers/
â”œâ”€â”€ auth_providers.dart                       # è®¤è¯æ¨¡å— Provider
â”œâ”€â”€ nutrition_providers.dart                 # è¥å…»æ¨¡å— Provider
â”œâ”€â”€ order_providers.dart                     # è®¢å•æ¨¡å— Provider
â”œâ”€â”€ recommendation_providers.dart            # æ¨èæ¨¡å— Provider
â””â”€â”€ user_providers.dart                      # ç”¨æˆ·æ¨¡å— Provider
```

### æ–‡æ¡£å’Œé…ç½®
```
docs/
â”œâ”€â”€ COORDINATOR_FACADE_GUIDE.md              # Coordinator/Facade æŒ‡å—
â”œâ”€â”€ SHARED_VS_GLOBAL_PAGES_BOUNDARY.md       # æ¨¡å—è¾¹ç•Œè¯´æ˜
â””â”€â”€ FRAMEWORK_OPTIMIZATION_COMPLETION.md      # ä¼˜åŒ–å®ŒæˆæŠ¥å‘Š

.github/workflows/ci.yml                      # CI/CD æµæ°´çº¿
.vscode/settings.json                         # VS Code é…ç½®
build.yaml                                    # ä»£ç ç”Ÿæˆé…ç½®

test/
â”œâ”€â”€ test_helpers/test_setup.dart              # æµ‹è¯•åŸºç¡€è®¾æ–½
â””â”€â”€ features/auth/                            # ç¤ºä¾‹æµ‹è¯•æ–‡ä»¶
```

## æŠ€æœ¯ç‰¹æ€§

### 1. æ¨¡å—åŒ–æ¶æ„
- æ¯ä¸ª feature æ¨¡å—ç‹¬ç«‹ç®¡ç†è‡ªå·±çš„ Providerã€è·¯ç”±å’Œä¸šåŠ¡é€»è¾‘
- æ¸…æ™°çš„ä¾èµ–è¾¹ç•Œï¼Œé¿å…å¾ªç¯ä¾èµ–
- æ”¯æŒæ¨¡å—çº§åˆ«çš„ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•

### 2. ç»Ÿä¸€çš„åº”ç”¨å±‚
- Facade æ¨¡å¼èšåˆä¸šåŠ¡é€»è¾‘
- ä¸º UI å±‚æä¾›ç®€æ´çš„æ¥å£
- ä¾¿äºä¸šåŠ¡é€»è¾‘çš„å¤ç”¨å’Œæµ‹è¯•

### 3. é›†ä¸­åŒ–åŸºç¡€è®¾æ–½
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- äº‹ä»¶é©±åŠ¨çš„æ¨¡å—é—´é€šä¿¡
- å¯æ‰©å±•çš„ä¸­é—´ä»¶å’Œè¿‡æ»¤å™¨æœºåˆ¶

### 4. å®Œæ•´çš„å¼€å‘æ”¯æŒ
- ä»£ç ç”Ÿæˆé…ç½®ä¼˜åŒ–
- å¼€å‘å·¥å…·é…ç½®
- æµ‹è¯•åŸºç¡€è®¾æ–½
- CI/CD æµæ°´çº¿

## å¼€å‘æŒ‡å¯¼

### 1. æ–°åŠŸèƒ½å¼€å‘æµç¨‹
1. åœ¨å¯¹åº”çš„ feature æ¨¡å—ä¸­å®ç° Domain å±‚
2. åœ¨ application/facades/ ä¸­æ·»åŠ ä¸šåŠ¡é—¨é¢
3. åœ¨ presentation å±‚å®ç° UI å’ŒçŠ¶æ€ç®¡ç†
4. åœ¨æ¨¡å—çš„ providers.dart ä¸­æ³¨å†Œæ–°çš„ Provider
5. åœ¨æ¨¡å—çš„ router.dart ä¸­æ·»åŠ è·¯ç”±é…ç½®

### 2. è·¨æ¨¡å—é€šä¿¡
- é€šè¿‡ `CentralizedEventBus` å‘å¸ƒå’Œè®¢é˜…äº‹ä»¶
- ä½¿ç”¨ Facade å±‚è¿›è¡Œä¸šåŠ¡é€»è¾‘è°ƒç”¨
- é¿å…ç›´æ¥çš„æ¨¡å—é—´ä¾èµ–

### 3. é”™è¯¯å¤„ç†
- ç»Ÿä¸€ä½¿ç”¨ `CentralizedErrorHandler` å¤„ç†é”™è¯¯
- åœ¨ä¸šåŠ¡å±‚ä½¿ç”¨ `handleBusinessError` æ–¹æ³•
- åœ¨ç½‘ç»œå±‚ä½¿ç”¨ `handleNetworkError` æ–¹æ³•

### 4. æµ‹è¯•å¼€å‘
- ä½¿ç”¨ `test/test_helpers/test_setup.dart` æä¾›çš„å·¥å…·
- éµå¾ªç¤ºä¾‹æµ‹è¯•æ–‡ä»¶çš„æ¨¡å¼
- ä¸ºæ¯ä¸ªæ¨¡å—åˆ›å»ºå¯¹åº”çš„æµ‹è¯•ç›®å½•

## æ„å»ºéªŒè¯

æ‰€æœ‰ä¼˜åŒ–éƒ½éµå¾ª"æ¡†æ¶çº§åˆ«"è¦æ±‚ï¼š
- âœ… åªåˆ›å»ºåŸºæœ¬ç»“æ„å’Œå ä½ä»£ç 
- âœ… ç¡®ä¿é¡¹ç›®èƒ½å¤ŸæˆåŠŸæ„å»º
- âœ… ä¸ºæœªæ¥åŠŸèƒ½å®ç°æä¾›æ¸…æ™°çš„å¼€å‘è·¯å¾„
- âœ… ä¸å®ç°å…·ä½“çš„ä¸šåŠ¡åŠŸèƒ½

## åç»­å»ºè®®

1. **é€æ­¥å®ç°ä¸šåŠ¡é€»è¾‘**ï¼šæŒ‰æ¨¡å—ä¼˜å…ˆçº§é€æ­¥å¡«å…… Facade å’Œ UseCase çš„å…·ä½“å®ç°
2. **å®Œå–„æµ‹è¯•è¦†ç›–**ï¼šä¸ºæ¯ä¸ªæ¨¡å—æ·»åŠ å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹
3. **é›†æˆçœŸå®API**ï¼šæ›¿æ¢æ¨¡æ‹Ÿæ•°æ®ï¼Œè¿æ¥çœŸå®çš„åç«¯æœåŠ¡
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šåœ¨å®ç°å…·ä½“åŠŸèƒ½åè¿›è¡Œæ€§èƒ½è°ƒä¼˜
5. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**ï¼šå®Œå–„UIç»„ä»¶å’Œäº¤äº’ä½“éªŒ

## æ€»ç»“

æœ¬æ¬¡æ¡†æ¶ä¼˜åŒ–è§£å†³äº†æ‚¨æå‡ºçš„æ‰€æœ‰æ¶æ„é—®é¢˜ï¼Œå»ºç«‹äº†æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œå’Œå¼€å‘è§„èŒƒã€‚é¡¹ç›®ç°åœ¨å…·å¤‡äº†ï¼š

- ğŸ—ï¸ **æ¸…æ™°çš„æ¶æ„è¾¹ç•Œ**ï¼šæ¨¡å—èŒè´£æ˜ç¡®ï¼Œä¾èµ–å…³ç³»æ¸…æ™°
- ğŸ”§ **å®Œå–„çš„å¼€å‘å·¥å…·**ï¼šä»£ç ç”Ÿæˆã€æµ‹è¯•ã€CI/CD æ”¯æŒå®Œæ•´
- ğŸ“š **è¯¦ç»†çš„å¼€å‘æŒ‡å—**ï¼šä¸ºå›¢é˜Ÿæä¾›æ˜ç¡®çš„å¼€å‘è§„èŒƒ
- ğŸš€ **å¯æ‰©å±•çš„åŸºç¡€è®¾æ–½**ï¼šæ”¯æŒæœªæ¥åŠŸèƒ½çš„å¿«é€Ÿå¼€å‘

é¡¹ç›®å·²å‡†å¤‡å¥½è¿›å…¥å…·ä½“åŠŸèƒ½å®ç°é˜¶æ®µï¼Œå¼€å‘å›¢é˜Ÿå¯ä»¥æŒ‰ç…§å»ºç«‹çš„æ¡†æ¶å’Œè§„èŒƒé«˜æ•ˆåœ°å®ç°ä¸šåŠ¡éœ€æ±‚ã€‚