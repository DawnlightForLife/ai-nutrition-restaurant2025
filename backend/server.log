
> smart-nutrition-restaurant-backend@1.0.0 start
> node server.js

等待数据库连接完成...
Mongoose默认连接已打开
数据库连接已就绪
2025-06-12 14:32:58 [[32MINFO[39M]: 创建模型 User 的类型: function
2025-06-12 14:32:58 [[32MINFO[39M]: 模型 User 注册成功
2025-06-12 14:32:58 [[32MINFO[39M]: 模型 User 是构造函数，可以使用new User()
User模型类型: function
User模型已成功导出为构造函数
User模型被其他模块引用，确保导出正确类型
2025-06-12 14:32:58 [[32MINFO[39M]: 模型工厂已启用缓存
2025-06-12 14:32:58 [[32MINFO[39M]: 创建模型 SystemConfig 的类型: function
2025-06-12 14:32:58 [[32MINFO[39M]: 创建模型 AuditLog 的类型: function
2025-06-12 14:32:58 [[32MINFO[39M]: 告警系统监控已启动
2025-06-12 14:32:58 [[32MINFO[39M]: 实时告警系统已初始化
2025-06-12 14:32:58 [[32MINFO[39M]: 创建模型 UserRole 的类型: function
2025-06-12 14:32:58 [[32MINFO[39M]: 创建模型 OAuthAccount 的类型: function
2025-06-12 14:32:58 [[32MINFO[39M]: 创建模型 ForumPost 的类型: function
2025-06-12 14:32:58 [[32MINFO[39M]: 创建模型 ForumComment 的类型: function
2025-06-12 14:32:58 [[32MINFO[39M]: 创建模型 DietaryPreference 的类型: function
2025-06-12 14:32:58 [[32MINFO[39M]: 模型 DietaryPreference 注册成功
2025-06-12 14:32:58 [[32MINFO[39M]: 模型 DietaryPreference 是构造函数，可以使用new DietaryPreference()
2025-06-12 14:32:58 [[32MINFO[39M]: 创建模型 AiRecommendation 的类型: function
2025-06-12 14:32:58 [[32MINFO[39M]: 创建模型 Nutritionist 的类型: function
2025-06-12 14:32:58 [[32MINFO[39M]: 创建模型 Dish 的类型: function
2025-06-12 14:32:58 [[32MINFO[39M]: 创建模型 StoreDish 的类型: function
2025-06-12 14:32:58 [[32MINFO[39M]: 创建模型 Store 的类型: function
2025-06-12 14:32:58 [[32MINFO[39M]: 创建模型 UserFavorite 的类型: function
2025-06-12 14:32:58 [[32MINFO[39M]: 创建模型 NutritionPlan 的类型: function
2025-06-12 14:32:58 [[32MINFO[39M]: 创建模型 Merchant 的类型: function
2025-06-12 14:32:58 [[32MINFO[39M]: 模型 Merchant 注册成功
2025-06-12 14:32:58 [[32MINFO[39M]: 模型 Merchant 是构造函数，可以使用new Merchant()
2025-06-12 14:32:58 [[32MINFO[39M]: 创建模型 Notification 的类型: function
2025-06-12 14:32:58 [[32MINFO[39M]: 创建模型 Order 的类型: function
2025-06-12 14:32:58 [[32MINFO[39M]: 创建模型 MerchantStats 的类型: function
2025-06-12 14:32:58 [[32MINFO[39M]: 模型 MerchantStats 注册成功
2025-06-12 14:32:58 [[32MINFO[39M]: 模型 MerchantStats 是构造函数，可以使用new MerchantStats()
2025-06-12 14:32:58 [[32MINFO[39M]: 创建模型 Subscription 的类型: function
2025-06-12 14:32:58 [[32MINFO[39M]: 使用内存缓存模式，未配置Redis
2025-06-12 14:32:58 [[32MINFO[39M]: 创建模型 DataAccessControl 的类型: function
2025-06-12 14:32:58 [[32MINFO[39M]: 连接池自动扩缩功能已启用，检查间隔： {"0":"秒"}
2025-06-12 14:32:58 [[32MINFO[39M]: 异步连接池管理器已创建
2025-06-12 14:32:58 [[32MINFO[39M]: 读取一致性服务已初始化，默认级别： {"0":"S","1":"E","2":"S","3":"S","4":"I","5":"O","6":"N"}
2025-06-12 14:32:58 [[32MINFO[39M]: 分布式事务服务已初始化，但未启用
2025-06-12 14:32:58 [[32MINFO[39M]: 请求重试服务已初始化
2025-06-12 14:32:58 [[32MINFO[39M]: 创建模型 UserPermission 的类型: function
Hook registered for event: nutritionist.certification.submitted
Hook registered for event: nutritionist.certification.reviewed
Hook registered for event: nutritionist.certification.expired
2025-06-12 14:32:58 [[32MINFO[39M]: Handlebars模板引擎加载成功
2025-06-12 14:32:58 [[32MINFO[39M]: SchemaJsonConverter服务已初始化 {"service":"SchemaJsonConverter"}
2025-06-12 14:32:58 [[32MINFO[39M]: 动态模型加载服务已创建 {"service":"DynamicModelLoader","enableSandbox":true,"enableGrayRelease":false,"grayReleasePercentage":10,"nodeId":"node-9702","nodeGroup":"default"}
2025-06-12 14:32:58 [[32MINFO[39M]: 正在初始化动态模型加载服务... {"service":"DynamicModelLoader"}
2025-06-12 14:32:58 [[32MINFO[39M]: 已初始化 31 个现有模型 {"service":"DynamicModelLoader"}
2025-06-12 14:32:58 [[32MINFO[39M]: 已设置模型文件监视器，监视目录: ./models {"service":"DynamicModelLoader"}
2025-06-12 14:32:58 [[32MINFO[39M]: 动态模型加载服务初始化完成 {"service":"DynamicModelLoader"}
缓存服务已初始化
分片服务已初始化
2025-06-12 14:32:58 [[32MINFO[39M]: 动态模型加载服务已成功初始化
数据分片服务已初始化
2025-06-12 14:32:58 [[32MINFO[39M]: 使用单一数据库连接
数据库连接池已初始化
2025-06-12 14:32:58 [[32MINFO[39M]: 初始化数据库优化管理器...
2025-06-12 14:32:58 [[32MINFO[39M]: 缓存服务已初始化
2025-06-12 14:32:58 [[32MINFO[39M]: 数据库优化管理器初始化完成
2025-06-12 14:32:58 [[32MINFO[39M]: 开始数据库优化服务健康检查...
2025-06-12 14:32:58 [[32MINFO[39M]: 数据库优化服务健康检查完成
数据库优化服务已初始化
2025-06-12 14:32:58 [[32MINFO[39M]: 创建断路器: db-operations
🔄 正在初始化定时任务...
📝 已注册定时任务: cleanupExpiredData, 执行计划: 0 3 * * *
📝 已注册定时任务: updateCache, 执行计划: 0 * * * *
📝 已注册定时任务: dbStats, 执行计划: 0 2 * * *
▶️ 已启动定时任务: cleanupExpiredData
▶️ 已启动定时任务: updateCache
▶️ 已启动定时任务: dbStats
✅ 已初始化 3 个定时任务
定时任务系统已初始化
所有服务初始化完成
服务器在端口 3000 上运行 (监听所有接口)
2025-06-12 14:32:58 [[32MINFO[39M]: Redis连接成功
2025-06-12 14:33:25 [[32MINFO[39M]: 为手机号 15112341234 生成验证码: 886338
2025-06-12 14:33:25 [[32MINFO[39M]: 临时存储验证码: 886338 到 15112341234
2025-06-12 14:33:25 [[32MINFO[39M]: 更新用户 6834093df7f69bd200d37dd5 的验证码信息
2025-06-12 14:33:25 [[32MINFO[39M]: 开发环境: 模拟发送验证码到 15112341234: 886338
2025-06-12 14:33:58 [[32MINFO[39M]: 连接池利用率低 (0.00), 缩容到 10
[AUTH DEBUG] 开始处理令牌验证
[AUTH DEBUG] 提取到令牌，长度: 267
[AUTH DEBUG] 使用密钥验证令牌: you...
[AUTH DEBUG] 令牌验证成功，用户ID: 6834093df7f69bd200d37dd5
2025-06-12 14:34:58 [[32MINFO[39M]: 连接池利用率低 (0.00), 缩容到 10
2025-06-12 14:35:38 [[32MINFO[39M]: 为手机号 15112341234 生成验证码: 801470
2025-06-12 14:35:38 [[32MINFO[39M]: 临时存储验证码: 801470 到 15112341234
2025-06-12 14:35:38 [[32MINFO[39M]: 更新用户 6834093df7f69bd200d37dd5 的验证码信息
2025-06-12 14:35:38 [[32MINFO[39M]: 开发环境: 模拟发送验证码到 15112341234: 801470
2025-06-12 14:35:58 [[32MINFO[39M]: 连接池利用率低 (0.00), 缩容到 10
2025-06-12 14:36:58 [[32MINFO[39M]: 连接池利用率低 (0.00), 缩容到 10
2025-06-12 14:37:58 [[31MERROR[39M]: [告警] CPU使用率严重超标: 95.3% {"metric":"cpu","value":0.9532221978089344,"threshold":0.9}
2025-06-12 14:37:58 [[32MINFO[39M]: 连接池利用率低 (0.00), 缩容到 10
2025-06-12 14:37:58 [[32MINFO[39M]: 开始数据库优化服务健康检查...
2025-06-12 14:37:58 [[32MINFO[39M]: 数据库优化服务健康检查完成
🔍 开始验证码登录流程: { phone: '15112341234', code: '801470' }
2025-06-12 14:38:34 [[32MINFO[39M]: 开始验证手机号 15112341234 的验证码: 801470
2025-06-12 14:38:34 [[32MINFO[39M]: 找到临时验证码数据: {"code":"801470","expiresAt":"2025-06-12T06:37:38.802Z","now":"2025-06-12T06:38:34.143Z","isExpired":true}
2025-06-12 14:38:34 [[33MWARN[39M]: 临时验证码已过期: 15112341234
2025-06-12 14:38:34 [[31MERROR[39M]: 验证码登录失败: {"error":{"statusCode":401,"status":"fail","isOperational":true,"metadata":{},"type":"UNAUTHORIZED"}}
2025-06-12 14:38:34 [[31MERROR[39M]: ❌ API错误: 验证码无效或已过期 验证码无效或已过期 {"statusCode":401,"status":"fail","isOperational":true,"metadata":{},"type":"UNAUTHORIZED","stack":"Error: 验证码无效或已过期\n    at Object.loginOrRegisterWithCode (/Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/services/user/authService.js:737:11)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exports.loginWithCode (/Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/controllers/user/authController.js:61:22)"}
2025-06-12 14:38:45 [[32MINFO[39M]: 为手机号 15112341234 生成验证码: 702513
2025-06-12 14:38:45 [[32MINFO[39M]: 临时存储验证码: 702513 到 15112341234
2025-06-12 14:38:45 [[32MINFO[39M]: 更新用户 6834093df7f69bd200d37dd5 的验证码信息
2025-06-12 14:38:45 [[32MINFO[39M]: 开发环境: 模拟发送验证码到 15112341234: 702513
2025-06-12 14:38:58 [[32MINFO[39M]: 连接池利用率低 (0.00), 缩容到 10
2025-06-12 14:39:15 [[31MERROR[39M]: 发送验证码失败: {"error":{"statusCode":429,"status":"fail","isOperational":true,"metadata":{},"type":"TOO_MANY_REQUESTS"}}
2025-06-12 14:39:15 [[31MERROR[39M]: ❌ API错误: 请等待 30 秒后再次获取验证码 请等待 30 秒后再次获取验证码 {"statusCode":429,"status":"fail","isOperational":true,"metadata":{},"type":"TOO_MANY_REQUESTS","stack":"Error: 请等待 30 秒后再次获取验证码\n    at Object.sendVerificationCode (/Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/services/user/authService.js:484:15)\n    at exports.sendVerificationCode (/Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/controllers/user/authController.js:96:25)\n    at Layer.handle [as handle_request] (/Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/node_modules/express/lib/router/route.js:149:13)\n    at Route.dispatch (/Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/node_modules/express/lib/router/route.js:119:3)\n    at Layer.handle [as handle_request] (/Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/node_modules/express/lib/router/layer.js:95:5)\n    at /Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/node_modules/express/lib/router/index.js:284:15\n    at Function.process_params (/Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/node_modules/express/lib/router/index.js:280:10)\n    at Function.handle (/Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/node_modules/express/lib/router/index.js:175:3)"}
2025-06-12 14:39:21 [[31MERROR[39M]: 发送验证码失败: {"error":{"statusCode":429,"status":"fail","isOperational":true,"metadata":{},"type":"TOO_MANY_REQUESTS"}}
2025-06-12 14:39:21 [[31MERROR[39M]: ❌ API错误: 请等待 25 秒后再次获取验证码 请等待 25 秒后再次获取验证码 {"statusCode":429,"status":"fail","isOperational":true,"metadata":{},"type":"TOO_MANY_REQUESTS","stack":"Error: 请等待 25 秒后再次获取验证码\n    at Object.sendVerificationCode (/Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/services/user/authService.js:484:15)\n    at exports.sendVerificationCode (/Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/controllers/user/authController.js:96:25)\n    at Layer.handle [as handle_request] (/Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/node_modules/express/lib/router/route.js:149:13)\n    at Route.dispatch (/Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/node_modules/express/lib/router/route.js:119:3)\n    at Layer.handle [as handle_request] (/Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/node_modules/express/lib/router/layer.js:95:5)\n    at /Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/node_modules/express/lib/router/index.js:284:15\n    at Function.process_params (/Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/node_modules/express/lib/router/index.js:280:10)\n    at Function.handle (/Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/node_modules/express/lib/router/index.js:175:3)"}
[AUTH DEBUG] 开始处理令牌验证
[AUTH DEBUG] 提取到令牌，长度: 267
[AUTH DEBUG] 使用密钥验证令牌: you...
[AUTH DEBUG] 令牌验证成功，用户ID: 6834093df7f69bd200d37dd5
2025-06-12 14:39:58 [[32MINFO[39M]: 连接池利用率低 (0.00), 缩容到 10
2025-06-12 14:40:05 [[32MINFO[39M]: 为手机号 15112341234 生成验证码: 775926
2025-06-12 14:40:05 [[32MINFO[39M]: 临时存储验证码: 775926 到 15112341234
2025-06-12 14:40:05 [[32MINFO[39M]: 更新用户 6834093df7f69bd200d37dd5 的验证码信息
2025-06-12 14:40:05 [[32MINFO[39M]: 开发环境: 模拟发送验证码到 15112341234: 775926
2025-06-12 14:40:58 [[32MINFO[39M]: 连接池利用率低 (0.00), 缩容到 10
2025-06-12 14:41:54 [[33MWARN[39M]: 数据库single连接断开
2025-06-12 14:41:54 [[32MINFO[39M]: Redis连接成功
2025-06-12 14:41:54 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"r","1":"e","2":"a","3":"d","4":" ","5":"E","6":"C","7":"O","8":"N","9":"N","10":"R","11":"E","12":"S","13":"E","14":"T"}
2025-06-12 14:41:54 [[32MINFO[39M]: Redis连接成功
2025-06-12 14:41:54 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"r","1":"e","2":"a","3":"d","4":" ","5":"E","6":"C","7":"O","8":"N","9":"N","10":"R","11":"E","12":"S","13":"E","14":"T"}
2025-06-12 14:41:54 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:41:55 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:41:55 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:41:55 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:41:56 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:41:56 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:41:56 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:41:57 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:41:57 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:41:58 [[33MWARN[39M]: [告警] CPU使用率过高: 79.4% {"metric":"cpu","value":0.7943750017257518,"threshold":0.7}
2025-06-12 14:41:58 [[32MINFO[39M]: 连接池利用率低 (0.00), 缩容到 10
2025-06-12 14:41:58 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:41:59 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:41:59 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:00 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:01 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:02 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:03 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:04 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:05 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:06 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:07 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:08 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:09 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:10 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:12 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:13 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:15 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:16 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:17 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:19 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:21 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:22 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:24 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:26 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:28 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:29 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:31 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:33 [[33MWARN[39M]: Redis连接错误，限流器将使用内存存储: {"0":"c","1":"o","2":"n","3":"n","4":"e","5":"c","6":"t","7":" ","8":"E","9":"C","10":"O","11":"N","12":"N","13":"R","14":"E","15":"F","16":"U","17":"S","18":"E","19":"D","20":" ","21":"1","22":"2","23":"7","24":".","25":"0","26":".","27":"0","28":".","29":"1","30":":","31":"6","32":"3","33":"7","34":"9"}
2025-06-12 14:42:35 [[32MINFO[39M]: Redis连接成功
2025-06-12 14:42:44 [[32MINFO[39M]: 数据库single连接成功
2025-06-12 14:42:44 [[32MINFO[39M]: 数据库single连接已重新建立
2025-06-12 14:42:58 [[32MINFO[39M]: 连接池利用率低 (0.00), 缩容到 10
2025-06-12 14:42:58 [[32MINFO[39M]: 开始数据库优化服务健康检查...
2025-06-12 14:42:58 [[32MINFO[39M]: 数据库优化服务健康检查完成
2025-06-12 14:43:07 [[32MINFO[39M]: 为手机号 15112341234 生成验证码: 204501
2025-06-12 14:43:07 [[32MINFO[39M]: 临时存储验证码: 204501 到 15112341234
2025-06-12 14:43:07 [[32MINFO[39M]: 更新用户 6834093df7f69bd200d37dd5 的验证码信息
2025-06-12 14:43:07 [[32MINFO[39M]: 开发环境: 模拟发送验证码到 15112341234: 204501
2025-06-12 14:43:58 [[33MWARN[39M]: [告警] CPU使用率过高: 72.2% {"metric":"cpu","value":0.7222840441081175,"threshold":0.7}
2025-06-12 14:43:58 [[32MINFO[39M]: 连接池利用率低 (0.00), 缩容到 10
2025-06-12 14:44:58 [[31MERROR[39M]: [告警] CPU使用率严重超标: 95.1% {"metric":"cpu","value":0.9505985170605469,"threshold":0.9}
2025-06-12 14:44:58 [[32MINFO[39M]: 连接池利用率低 (0.00), 缩容到 10
2025-06-12 14:45:58 [[32MINFO[39M]: 连接池利用率低 (0.00), 缩容到 10
2025-06-12 14:46:58 [[32MINFO[39M]: 连接池利用率低 (0.00), 缩容到 10
2025-06-12 14:47:58 [[32MINFO[39M]: 连接池利用率低 (0.00), 缩容到 10
2025-06-12 14:47:58 [[32MINFO[39M]: 开始数据库优化服务健康检查...
2025-06-12 14:47:58 [[32MINFO[39M]: 数据库优化服务健康检查完成
2025-06-12 14:48:58 [[32MINFO[39M]: 连接池利用率低 (0.00), 缩容到 10
2025-06-12 14:49:58 [[32MINFO[39M]: 连接池利用率低 (0.00), 缩容到 10
2025-06-12 14:50:58 [[32MINFO[39M]: 连接池利用率低 (0.00), 缩容到 10
2025-06-12 14:51:58 [[32MINFO[39M]: 连接池利用率低 (0.00), 缩容到 10
2025-06-12 14:52:58 [[32MINFO[39M]: 连接池利用率低 (0.00), 缩容到 10
2025-06-12 14:52:58 [[32MINFO[39M]: 开始数据库优化服务健康检查...
2025-06-12 14:52:58 [[32MINFO[39M]: 数据库优化服务健康检查完成
2025-06-12 14:53:43 [[32MINFO[39M]: 为手机号 15112341234 生成验证码: 991999
2025-06-12 14:53:43 [[32MINFO[39M]: 临时存储验证码: 991999 到 15112341234
2025-06-12 14:53:43 [[32MINFO[39M]: 更新用户 6834093df7f69bd200d37dd5 的验证码信息
2025-06-12 14:53:43 [[32MINFO[39M]: 开发环境: 模拟发送验证码到 15112341234: 991999
2025-06-12 14:53:58 [[32MINFO[39M]: 连接池利用率低 (0.00), 缩容到 10
2025-06-12 14:54:58 [[32MINFO[39M]: 连接池利用率低 (0.00), 缩容到 10
2025-06-12 14:55:58 [[32MINFO[39M]: 连接池利用率低 (0.00), 缩容到 10
2025-06-12 14:56:58 [[32MINFO[39M]: 连接池利用率低 (0.00), 缩容到 10
2025-06-12 14:57:25 [[33MWARN[39M]: 数据库single连接断开
接收到SIGTERM信号，准备关闭服务...
正在关闭服务器...
Mongoose连接已关闭
2025-06-12 14:57:25 [[32MINFO[39M]: 所有数据库连接已关闭
ModelFactory连接已关闭
关闭过程中出错: Error: Cannot find module './services/core/batchProcessService'
Require stack:
- /Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/server.js
    at Function._resolveFilename (node:internal/modules/cjs/loader:1225:15)
    at Function._load (node:internal/modules/cjs/loader:1055:27)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:220:24)
    at Module.require (node:internal/modules/cjs/loader:1311:12)
    at require (node:internal/modules/helpers:136:16)
    at process.gracefulShutdown (/Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/server.js:277:33)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  code: 'MODULE_NOT_FOUND',
  requireStack: [
    '/Volumes/workSpace/smart_nutrition_restaurant/ai-nutrition-restaurant2025/backend/server.js'
  ]
}
