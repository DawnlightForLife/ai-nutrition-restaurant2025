# 类型系统结构冻结说明 (TYPES_FREEZE.md)

**版本:** 1.0  
**状态:** 已冻结  
**更新日期:** 2025-05-17  
**编制人:** 系统架构组

## 📑 目录

- [1. 概述](#1-概述)
- [2. 设计原则](#2-设计原则)
- [3. 目录结构](#3-目录结构)
- [4. 类型模块详情](#4-类型模块详情)
  - [4.1 模型类型定义 (models/)](#41-模型类型定义-models)
  - [4.2 数据传输对象 (dto/)](#42-数据传输对象-dto)
  - [4.3 枚举类型定义 (enums/)](#43-枚举类型定义-enums)
  - [4.4 API通用结构定义 (api/)](#44-api通用结构定义-api)
  - [4.5 JSON Schema定义 (schema/)](#45-json-schema定义-schema)
  - [4.6 类型聚合导出 (index.d.ts)](#46-类型聚合导出-indexdts)
- [5. 冻结范围](#5-冻结范围)
- [6. 更新与维护](#6-更新与维护)

## 1. 概述

本文档定义了智能营养餐厅系统的类型(Types)结构，类型系统使用TypeScript实现，按用途划分为不同子模块，为系统提供静态类型检查、接口约束、代码提示和自动文档生成等功能。类型系统确保前后端数据结构一致性，提高开发效率和代码可维护性。

类型层作为系统开发的基础支撑，其结构冻结对保障开发规范和类型一致性至关重要。本文档详细说明了各类型模块的用途、组成和更新方式，为开发团队提供统一的类型定义参考。

## 2. 设计原则

- **分层分类原则**: 按照类型用途进行分类，确保类型定义清晰且易于查找
- **前后端共享原则**: 关键类型定义可供前后端共享使用，确保数据结构一致性
- **单一职责原则**: 每个类型文件专注于定义特定领域的数据结构
- **模型驱动原则**: 类型定义与数据模型保持一致，自动适配数据库结构
- **接口驱动原则**: DTO类型定义与API接口参数和返回值保持一致
- **可扩展原则**: 类型定义支持后续扩展，同时保持向后兼容性
- **命名规范原则**: 采用一致的命名规范，提高代码可读性和可维护性

## 3. 目录结构

类型系统采用以下目录结构：

```
/backend/types/
├── models/                               # 每个后端 Mongoose 模型的类型定义
│   ├── User.d.ts                         # 用户模型字段类型（User 表）
│   ├── NutritionProfile.d.ts             # 营养档案模型（档案名、目标、身高体重等）
│   ├── Recommendation.d.ts               # 推荐方案（planId、餐食、AI评分等）
│   ├── Order.d.ts                        # 订单字段结构（类型、金额、状态）
│   ├── Consultation.d.ts                 # 营养咨询模型结构（提问内容、营养师、状态等）
│   ├── ForumPost.d.ts                    # 帖子结构（作者、内容、点赞数）
│   └── Subscription.d.ts                 # 订阅套餐模型（周期、价格、状态）
│
├── dto/                                  # 各类 API 请求体/响应体结构
│   ├── AuthRequest.d.ts                  # 登录、注册、验证码发送参数
│   ├── ProfileUpdateRequest.d.ts         # 修改营养档案的字段结构
│   ├── OrderSubmitRequest.d.ts           # 提交订单字段结构
│   ├── FeedbackRequest.d.ts              # 用户提交意见反馈结构
│   └── RecommendationResult.d.ts         # 推荐详情返回结构（含 meals、AI score）
│
├── enums/                                # 系统中的所有枚举类型
│   ├── RoleType.ts                       # 系统角色枚举：user / nutritionist / merchant / admin
│   ├── MerchantType.ts                   # 商家类型枚举（健身房、月子中心等）
│   ├── SubscriptionPlan.ts               # 套餐周期、价格类型等
│   ├── Gender.ts                         # 性别 / 年龄段枚举
│   └── NotificationType.ts               # 系统通知类型枚举（推送提醒、推荐完成等）
│
├── api/                                  # 通用结构定义（统一接口返回体等）
│   ├── ApiResponse.d.ts                  # 通用 API 响应结构（message, data, success）
│   └── Pagination.d.ts                   # 分页结构（page, size, total, list）
│
├── schema/                               # 自动生成的 JSON Schema（供前端或文档使用）
│   ├── User.schema.json                  # 用户模型的JSON Schema
│   ├── NutritionProfile.schema.json      # 营养档案的JSON Schema
│   └── Order.schema.json                 # 订单的JSON Schema
│
└── index.d.ts                            # 聚合导出所有常用类型
```

## 4. 类型模块详情

### 4.1 模型类型定义 (models/)

**用途**: 定义系统中所有数据模型的字段类型，与MongoDB/Mongoose模型一一对应，用于服务层和模型层的类型约束。

| 文件名 | 功能说明 | 面向前端导出 | 自动生成 | 绑定文件 | 冻结状态 |
|-------|---------|------------|---------|---------|---------|
| **User.d.ts** | 用户模型字段类型定义，包含用户基本信息、认证信息等 | ❌ 仅后端使用 | ❌ 手动维护 | ✅ 绑定 `models/userModel.js` | ✅ 已冻结 |
| **NutritionProfile.d.ts** | 营养档案模型类型定义，包含用户健康信息、饮食偏好等 | ❌ 仅后端使用 | ❌ 手动维护 | ✅ 绑定 `models/nutritionProfileModel.js` | ✅ 已冻结 |
| **Recommendation.d.ts** | 营养推荐方案类型定义，包含推荐餐食、营养素分析等 | ❌ 仅后端使用 | ❌ 手动维护 | ✅ 绑定 `models/recommendationModel.js` | ✅ 已冻结 |
| **Order.d.ts** | 订单模型类型定义，包含订单信息、支付状态等 | ❌ 仅后端使用 | ❌ 手动维护 | ✅ 绑定 `models/orderModel.js` | ✅ 已冻结 |
| **Consultation.d.ts** | 营养咨询模型类型定义，包含咨询内容、回复状态等 | ❌ 仅后端使用 | ❌ 手动维护 | ✅ 绑定 `models/consultationModel.js` | ✅ 已冻结 |
| **ForumPost.d.ts** | 社区帖子模型类型定义，包含帖子内容、评论、点赞等 | ❌ 仅后端使用 | ❌ 手动维护 | ✅ 绑定 `models/forumPostModel.js` | ✅ 已冻结 |
| **Subscription.d.ts** | 订阅套餐模型类型定义，包含套餐类型、价格、周期等 | ❌ 仅后端使用 | ❌ 手动维护 | ✅ 绑定 `models/subscriptionModel.js` | ✅ 已冻结 |

**类型应用场景**:
- 模型实例的类型检查和字段约束
- 数据库操作的参数和返回值类型定义
- 服务层处理模型数据的类型安全

**冻结说明**: 结构已冻结，建议扩展新字段时保持模块归属不变，与对应的数据库模型保持同步更新。

### 4.2 数据传输对象 (dto/)

**用途**: 定义API请求和响应的数据结构，用于控制器层和前端交互的数据格式约束，提供接口文档生成的类型基础。

| 文件名 | 功能说明 | 面向前端导出 | 自动生成 | 绑定文件 | 冻结状态 |
|-------|---------|------------|---------|---------|---------|
| **AuthRequest.d.ts** | 认证相关请求参数定义，包含登录、注册、验证码等 | ✅ 前端共享 | ❌ 手动维护 | ✅ 绑定 `controllers/authController.js` | ✅ 已冻结 |
| **ProfileUpdateRequest.d.ts** | 营养档案更新请求参数定义 | ✅ 前端共享 | ❌ 手动维护 | ✅ 绑定 `controllers/profileController.js` | ✅ 已冻结 |
| **OrderSubmitRequest.d.ts** | 订单提交请求参数定义 | ✅ 前端共享 | ❌ 手动维护 | ✅ 绑定 `controllers/orderController.js` | ✅ 已冻结 |
| **FeedbackRequest.d.ts** | 反馈提交请求参数定义 | ✅ 前端共享 | ❌ 手动维护 | ✅ 绑定 `controllers/feedbackController.js` | ✅ 已冻结 |
| **RecommendationResult.d.ts** | 推荐结果响应结构定义 | ✅ 前端共享 | ❌ 手动维护 | ✅ 绑定 `controllers/recommendationController.js` | ✅ 已冻结 |

**类型应用场景**:
- API接口请求体的参数验证和类型约束
- API响应数据的格式定义和类型安全
- 前后端共享的数据结构定义，确保数据一致性
- 接口文档自动生成的数据结构依据

**冻结说明**: 结构已冻结，建议扩展新接口参数时保持模块归属不变，与对应的控制器保持同步更新。

### 4.3 枚举类型定义 (enums/)

**用途**: 定义系统中的所有枚举值，用于前后端共享的常量和类型限制，提供类型安全的状态和类型选择。

| 文件名 | 功能说明 | 面向前端导出 | 自动生成 | 绑定文件 | 冻结状态 |
|-------|---------|------------|---------|---------|---------|
| **RoleType.ts** | 用户角色类型枚举，定义系统中的角色权限 | ✅ 前端共享 | ❌ 手动维护 | ✅ 多处引用 | ✅ 已冻结 |
| **MerchantType.ts** | 商家类型枚举，定义不同类型的商家分类 | ✅ 前端共享 | ❌ 手动维护 | ✅ 多处引用 | ✅ 已冻结 |
| **SubscriptionPlan.ts** | 订阅计划类型枚举，定义不同的订阅套餐 | ✅ 前端共享 | ❌ 手动维护 | ✅ 多处引用 | ✅ 已冻结 |
| **Gender.ts** | 性别和年龄段枚举，用于用户基本信息 | ✅ 前端共享 | ❌ 手动维护 | ✅ 多处引用 | ✅ 已冻结 |
| **NotificationType.ts** | 通知类型枚举，定义不同种类的系统通知 | ✅ 前端共享 | ❌ 手动维护 | ✅ 多处引用 | ✅ 已冻结 |

**类型应用场景**:
- 模型字段的可选值限制
- 业务逻辑中的状态判断和处理
- 前端界面的选项展示和数据验证
- 数据库查询条件的类型安全

**冻结说明**: 结构已冻结，建议添加新枚举值时保持模块归属不变，谨慎添加新枚举以避免破坏现有逻辑。

### 4.4 API通用结构定义 (api/)

**用途**: 定义API接口的通用数据结构，如统一响应格式、分页结构等，确保接口返回格式的一致性。

| 文件名 | 功能说明 | 面向前端导出 | 自动生成 | 绑定文件 | 冻结状态 |
|-------|---------|------------|---------|---------|---------|
| **ApiResponse.d.ts** | 统一API响应结构定义，包含状态、消息和数据 | ✅ 前端共享 | ❌ 手动维护 | ✅ 全局中间件 | ✅ 已冻结 |
| **Pagination.d.ts** | 分页数据结构定义，用于列表数据的分页返回 | ✅ 前端共享 | ❌ 手动维护 | ✅ 多处引用 | ✅ 已冻结 |

**类型应用场景**:
- 中间件中统一响应格式的处理
- 控制器返回数据的格式规范
- 前端处理API响应的类型安全
- 分页查询结果的标准化封装

**冻结说明**: 结构已冻结，这些通用结构是系统稳定性的基础，不建议修改现有结构，可以添加新的通用结构。

### 4.5 JSON Schema定义 (schema/)

**用途**: 自动生成的JSON Schema文件，用于前端验证、接口文档生成和数据结构可视化，基于模型类型定义自动构建。

| 文件名 | 功能说明 | 面向前端导出 | 自动生成 | 绑定文件 | 冻结状态 |
|-------|---------|------------|---------|---------|---------|
| **User.schema.json** | 用户模型的JSON Schema定义 | ✅ 前端共享 | ✅ 自动生成 | ✅ 绑定 `models/User.d.ts` | 🔄 自动更新 |
| **NutritionProfile.schema.json** | 营养档案的JSON Schema定义 | ✅ 前端共享 | ✅ 自动生成 | ✅ 绑定 `models/NutritionProfile.d.ts` | 🔄 自动更新 |
| **Order.schema.json** | 订单的JSON Schema定义 | ✅ 前端共享 | ✅ 自动生成 | ✅ 绑定 `models/Order.d.ts` | 🔄 自动更新 |

**类型应用场景**:
- Swagger/OpenAPI文档生成
- 前端表单验证规则的自动生成
- 第三方系统集成的接口定义
- 数据结构的可视化展示

**冻结说明**: 文件结构已冻结，内容随源类型定义自动更新，不需要手动维护，修改源类型定义后会自动重新生成。

### 4.6 类型聚合导出 (index.d.ts)

**用途**: 统一导出系统中常用的类型定义，简化类型导入路径，提供便捷的类型引用方式。

**功能说明**:
- 聚合导出所有模型类型、DTO类型、枚举类型和API通用结构
- 为前端和后端提供统一的类型导入入口
- 简化类型引用路径，提高开发效率

**冻结说明**: 结构已冻结，随类型定义的增加和变化，保持同步更新导出内容。

## 5. 冻结范围

以下类型系统内容被定义为冻结状态：

1. **目录结构**
   - 顶级目录的组织方式和分类逻辑
   - 各类型模块的命名规范和分组规则

2. **类型定义方式**
   - 模型类型与数据库模型的映射关系
   - DTO类型与API接口的绑定方式
   - 枚举类型的定义格式和使用规范

3. **文件命名规则**
   - 模型类型文件使用 `.d.ts` 后缀
   - 枚举类型文件使用 `.ts` 后缀
   - JSON Schema文件使用 `.schema.json` 后缀

4. **类型导出机制**
   - index.d.ts 的聚合导出方式
   - 面向前端共享的类型导出规范

5. **自动生成流程**
   - JSON Schema的自动生成机制
   - 类型同步更新的触发条件

## 6. 更新与维护

尽管类型系统结构已冻结，但以下内容需要持续更新：

1. **扩展模型字段**
   - 在现有模型类型定义中添加新字段
   - 保持与数据库模型的同步更新

2. **增加新的DTO类型**
   - 为新增API接口添加对应的DTO类型定义
   - 遵循现有命名规范和结构要求

3. **添加新的枚举值**
   - 在现有枚举类型中添加新的枚举值
   - 确保前后端同步更新枚举定义

4. **扩展API通用结构**
   - 根据需求添加新的通用结构定义
   - 保持现有通用结构的稳定性

5. **更新类型导出**
   - 在index.d.ts中添加新增类型的导出
   - 保持导出类型的组织结构一致性

---
⚠️ **注意**: 本文档定义的类型系统结构已冻结，未经架构委员会批准，不得更改类型的目录结构、命名规范和组织方式。所有扩展应在现有结构框架内进行。 