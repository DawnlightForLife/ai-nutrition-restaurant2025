# 常量结构冻结文档 (CONSTANTS_FREEZE.md)

**版本:** 1.0  
**状态:** 已冻结  
**更新日期:** 2025-05-17  
**编制人:** 系统架构组

## 📑 目录

- [1. 概述](#1-概述)
- [2. 设计原则](#2-设计原则)
- [3. 目录结构](#3-目录结构)
- [4. 常量模块详情](#4-常量模块详情)
- [5. 冻结范围](#5-冻结范围)
- [6. 更新与维护](#6-更新与维护)

## 1. 概述

本文档定义了智能营养餐厅系统的常量层结构，包括各类枚举、状态码和配置常量。常量层统一管理系统所有不可变数据和枚举值，确保系统内部数据一致性，并为前端提供标准化的数据字典。

常量层作为系统基础数据的关键组成部分，其结构冻结对保障系统稳定性和前后端数据交互的一致性至关重要。

## 2. 设计原则

- **统一管理原则**: 所有系统枚举值和常量集中在常量目录下管理，避免散布
- **结构一致原则**: 所有枚举采用统一的数据结构格式，方便调用和维护
- **前后端共享原则**: 常量设计同时考虑后端逻辑和前端展示需求
- **多语言支持原则**: 枚举设计包含显示标签，支持国际化扩展
- **扩展性原则**: 常量结构支持未来扩展，但基础结构保持稳定
- **语义化命名原则**: 常量名称采用语义化设计，提高代码可读性
- **命名空间原则**: 通过模块拆分和命名空间避免常量冲突

## 3. 目录结构

常量层采用以下目录结构：

```
/backend/constants/
├── index.js                  # 常量聚合导出
├── roles.js                  # 所有系统角色枚举
├── merchantTypes.js          # 商家类型枚举
├── genderOptions.js          # 性别枚举
├── regionCodes.js            # 地区编码结构
├── notificationTypes.js      # 系统通知类型
├── forumTags.js              # 论坛标签
├── orderStatus.js            # 订单状态枚举
└── subscriptionPlans.js      # 订阅套餐类型
```

## 4. 常量模块详情

| 文件名 | 枚举结构 | UI标签支持 | JSON导出 | 冻结状态 | 描述 |
|-------|---------|-----------|---------|---------|------|
| **roles.js** | 🔹 对象键值结构 | ✅ 支持label | ✅ 支持 | ✅ 已冻结 | 系统角色枚举（用户/商家/营养师/管理员） |
| **merchantTypes.js** | 🔹 对象键值结构 | ✅ 支持label | ✅ 支持 | ✅ 已冻结 | 商家类型枚举（健身房/月子中心/营养餐厅/团体用户） |
| **genderOptions.js** | 🔹 对象键值结构 | ✅ 支持label | ✅ 支持 | ✅ 已冻结 | 性别枚举（男/女/未说明） |
| **regionCodes.js** | 🔹 嵌套对象结构 | ✅ 支持label | ✅ 支持 | ✅ 已冻结 | 地区编码结构（省/市/区） |
| **notificationTypes.js** | 🔹 对象键值结构 | ✅ 支持label | ✅ 支持 | ✅ 已冻结 | 系统通知类型（审核结果/推荐完成/订单通知等） |
| **forumTags.js** | 🔹 对象数组结构 | ✅ 支持label | ✅ 支持 | ✅ 已冻结 | 论坛标签（健康饮食/体重管理等） |
| **orderStatus.js** | 🔹 对象键值结构 | ✅ 支持label | ✅ 支持 | ✅ 已冻结 | 订单状态枚举（待支付/已支付/配送中/已完成等） |
| **subscriptionPlans.js** | 🔹 对象键值结构 | ✅ 支持label | ✅ 支持 | ✅ 已冻结 | 订阅套餐类型（月度/季度/年度套餐） |
| **index.js** | 🔄 聚合导出 | - | - | ✅ 已冻结 | 聚合所有常量模块并统一导出 |

### 常量结构规范

每个常量文件采用统一的结构格式，确保一致性和易用性：

```javascript
// 标准枚举结构示例
module.exports = {
  ENUM_KEY: { value: 'enum_value', label: '显示名称' },
  // 更多枚举...
};
```

这种结构具有以下特点：
- 使用大写常量名作为键
- 值为对象，包含 `value`（实际值）和 `label`（显示名称）
- 支持前端直接用于UI组件（如下拉菜单、单选框）
- 支持通过API接口导出为JSON格式

### 常量使用方式

常量可通过以下方式在系统中使用：

1. **直接引用常量值**:
   ```javascript
   const { roles } = require('../constants');
   if (user.role === roles.ADMIN.value) {
     // 管理员逻辑
   }
   ```

2. **用于前端UI展示**:
   ```javascript
   // API返回用于前端下拉菜单
   const genderList = Object.values(genderOptions);
   return genderList; // [{value: 'male', label: '男'}, ...]
   ```

3. **用于数据验证**:
   ```javascript
   const validRoles = Object.values(roles).map(r => r.value);
   if (!validRoles.includes(req.body.role)) {
     return res.status(400).send('无效的角色类型');
   }
   ```

## 5. 冻结范围

以下常量层内容被定义为冻结状态：

1. **枚举结构格式**
   - 所有枚举采用 `{ value, label }` 的对象结构
   - 枚举键名采用大写下划线命名法（如 `USER_ROLE`）
   - 常量文件采用小驼峰命名法（如 `orderStatus.js`）

2. **常量类型**
   - 系统角色类型（已冻结核心角色）
   - 性别枚举（已冻结，不再扩展）
   - 商家类型（已冻结核心类型）
   - 订阅计划类型（已冻结计划周期）

3. **常量导出机制**
   - 通过 `index.js` 聚合导出的模式已冻结
   - 单文件模块导出格式已冻结

## 6. 更新与维护

尽管常量层结构已冻结，但特定情况下允许进行受控更新：

1. **允许的变更**
   - 向现有枚举添加新的枚举值（保持向后兼容）
   - 调整枚举显示标签（不影响value值）
   - 新增常量类型文件（遵循现有结构模式）

2. **变更流程**
   - 提交常量变更方案
   - 架构评审委员会审核
   - 前后端协同测试
   - 同步更新API文档

3. **版本控制**
   - 添加新枚举值不升级版本号
   - 新增常量类型文件增加次版本号
   - 所有变更必须记录在常量变更日志中
   - 变更后同步通知前端团队

---
⚠️ **注意**: 本文档定义的常量层结构已冻结，未经架构委员会批准，不得更改常量结构和命名约定。枚举值应通过API传递给前端，避免前端硬编码。 