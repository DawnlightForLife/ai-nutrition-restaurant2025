# 数据库模型版本控制

本文档记录AI营养餐厅应用数据库模型的版本历史和发布情况，用于追踪模型演变和冻结状态。

## 版本历史

| 版本号 | 发布日期 | 状态 | 主要变更 | 负责人 |
|--------|----------|------|----------|--------|
| v1.0.0 | 2023-01-15 | 初始版本 | 建立基础用户模型和营养档案模型 | 张工 |
| v1.1.0 | 2023-02-10 | 功能扩展 | 添加AI推荐模型和商家模型 | 李工 |
| v1.2.0 | 2023-03-05 | 功能扩展 | 添加订单模型和咨询模型 | 王工 |
| v1.3.0 | 2023-03-20 | 功能扩展 | 添加论坛帖子模型和管理员模型 | 赵工 |
| v1.4.0 | 2023-03-28 | 功能扩展 | 添加审计日志模型和用户角色模型 | 刘工 |
| v2.0.0 | 2023-04-01 | **冻结版本** | 所有核心模型结构冻结，禁止修改 | 项目组 |
| v2.1.0 | 2023-04-10 | **冻结扩展** | 扩展模型结构冻结，禁止修改 | 项目组 |
| v2.2.0 | 2023-04-20 | 功能新增 | 添加消息提醒模型和OAuth账号绑定模型 | 开发团队 |

## 冻结模型清单

### 核心模型（v2.0.0版本冻结）

以下核心模型在v2.0.0版本中被冻结，任何修改必须经过正式审批流程：

1. userModel.js (v2.0.0)
2. nutritionProfileModel.js (v2.0.0)
3. aiRecommendationModel.js (v2.0.0)
4. forumPostModel.js (v2.0.0)
5. consultationModel.js (v2.0.0)
6. merchantModel.js (v2.0.0)
7. orderModel.js (v2.0.0)
8. adminModel.js (v2.0.0)
9. auditLogModel.js (v2.0.0)
10. userRoleModel.js (v2.0.0)

### 扩展模型（v2.1.0版本冻结）

以下扩展模型在v2.1.0版本中被冻结，任何修改必须经过正式审批流程：

11. healthDataModel.js (v2.1.0)
12. dishModel.js (v2.1.0)
13. storeDishModel.js (v2.1.0)
14. storeModel.js (v2.1.0)
15. subscriptionModel.js (v2.1.0)
16. userFavoriteModel.js (v2.1.0)
17. forumCommentModel.js (v2.1.0)
18. dataAccessControlModel.js (v2.1.0)
19. dbMetricsModel.js (v2.1.0)
20. merchantStatsModel.js (v2.1.0)

### 新增模型（v2.2.0版本）

以下是v2.2.0版本新增的模型，遵循项目规范但不受冻结限制：

21. notificationModel.js (v2.2.0) - 消息提醒模型
22. oauthAccountModel.js (v2.2.0) - OAuth账号绑定模型

## 模型变更申请记录

| 申请编号 | 申请日期 | 模型名称 | 变更描述 | 申请人 | 状态 | 审批人 | 实施日期 |
|----------|----------|----------|----------|--------|------|--------|----------|
| MCA-001 | 2023-04-15 | userModel | 添加avatarUrl字段 | 张工 | 已驳回 | 项目经理 | - |
| MCA-002 | 2023-04-22 | nutritionProfileModel | 添加BMI计算字段 | 李工 | 待审批 | - | - |
| MCA-003 | 2023-05-05 | orderModel | 添加配送跟踪字段 | 王工 | 已批准 | 架构师、产品经理 | 2023-05-20 |
| MCA-004 | 2023-04-18 | 新增模型 | 添加notificationModel和oauthAccountModel | 开发团队 | 已批准 | 项目经理、架构师 | 2023-04-20 |

## 变更流程

1. **提出申请**：
   - 填写模型变更申请表
   - 提供详细的变更理由和技术实现方案
   - 评估变更对现有系统的影响

2. **审核流程**：
   - 技术审核：由架构师评估技术可行性
   - 业务审核：由产品经理评估业务需求合理性
   - 安全审核：由安全专家评估数据安全风险

3. **实施计划**：
   - 制定数据迁移方案
   - 开发前后端代码变更
   - 准备回滚计划

4. **测试验证**：
   - 在开发环境验证功能
   - 在测试环境验证数据迁移
   - 性能测试和回归测试

5. **生产部署**：
   - 确认最终变更计划
   - 安排生产环境部署时间
   - 执行数据迁移和代码部署
   - 监控系统稳定性

## 模型文档维护

模型文档将随每次变更同步更新，包括：

1. `DATABASE_FROZEN_MODELS.md` - 模型冻结说明文档
2. `MODEL_COMPLIANCE_GUIDE.md` - 前端合规开发指南
3. `API_CONTRACT.md` - API契约文档
4. `MODEL_VISUALIZATION.md` - 模型可视化文档

## 注意事项

1. 所有模型变更必须严格遵循变更流程
2. 未经批准不得在生产环境修改模型结构
3. 每次变更后必须更新相关文档
4. 保持模型版本号与应用版本号的一致性 